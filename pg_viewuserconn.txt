SELECT (COUNT(*) * 100 / setting::int) 
 FROM pg_stat_activity, pg_settings 
 WHERE name='max_connections' ;

SELECT 
    COUNT(*) AS current_connections,
    (SELECT setting::int FROM pg_settings WHERE name = 'max_connections') AS max_connections,
    ROUND((COUNT(*) * 100.0) / (SELECT setting::int FROM pg_settings WHERE name = 'max_connections'), 2) AS used_percent
FROM pg_stat_activity;
